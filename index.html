<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AssignmentX Numbers Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/tone@14.7.58/build/Tone.js"></script>
    <style>
        :root {
            --mathly-grey-dark: #2c3e50;
            --mathly-grey-light: #ecf0f1;
            --mathly-blue: #3498db;
            --mathly-green: #2ecc71;
            --mathly-red: #e74c3c;
            --mathly-yellow: #f1c40f;
            --lvl-bg: linear-gradient(135deg, #1a2a6c 0%, #2b3952 100%);
        }

        #game-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 550px;
            background: var(--lvl-bg);
            transition: background 0.8s ease;
            color: var(--mathly-grey-light);
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            border-radius: inherit;
        }

        #game-wrapper:fullscreen { border-radius: 0; width: 100vw; height: 100vh; }

        .bg-symbols {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            font-size: 10vw; color: rgba(255, 255, 255, 0.03);
            pointer-events: none; z-index: 0; font-weight: 900;
            display: flex; flex-wrap: wrap; justify-content: center; align-items: center;
        }

        #game-container {
            width: 90%; max-width: 500px; padding: 25px;
            background: rgba(0, 0, 0, 0.35); border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1; text-align: center;
        }

        #stats-bar {
            display: flex; justify-content: space-between;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px; border-radius: 12px; margin-bottom: 20px;
        }
        .stat-item { display: flex; flex-direction: column; }
        .stat-label { font-size: 0.65em; text-transform: uppercase; opacity: 0.7; }
        .stat-value { font-size: 1.1em; font-weight: 900; color: var(--mathly-blue); }

        #game-area {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px; border-radius: 15px; margin-bottom: 20px;
        }
        #problem-text { font-size: 1.2em; font-weight: 700; margin-bottom: 15px; min-height: 60px; line-height: 1.4; }

        input {
            width: 100%; padding: 12px; font-size: 1.1em; border-radius: 8px; border: 2px solid var(--mathly-blue);
            background: rgba(0,0,0,0.4); color: white; text-align: center; margin-bottom: 10px;
        }

        .btn {
            width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: 900;
            cursor: pointer; text-transform: uppercase; transition: 0.2s;
        }
        .btn-primary { background: var(--mathly-green); color: var(--mathly-grey-dark); }
        
        #controls { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-top: 15px; }
        .btn-sec { background: var(--mathly-blue); color: white; font-size: 0.6em; padding: 8px 1px; }

        .correct { color: var(--mathly-green); }
        .incorrect { color: var(--mathly-red); }
        .hidden { display: none !important; }

        #levels-modal {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 10;
        }
        .modal-content { background: var(--mathly-grey-dark); padding: 25px; border-radius: 15px; width: 85%; }
        .level-card {
            background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; margin-bottom: 8px;
            cursor: pointer; display: flex; justify-content: space-between;
        }
    </style>
</head>
<body style="margin:0; padding:0;">

<div id="game-wrapper">
    <div class="bg-symbols">Œ£ ‚à´ ‚àû ‚â† ‚âà ¬± ‚àö œÄ Œ± Œ≤ Œ≥ Œî Œ∏ Œ©</div>
    
    <div id="game-container">
        <header>
            <h2 id="game-title" style="color: var(--mathly-yellow); margin-bottom: 10px;">AssignmentX Numbers Game</h2>
        </header>

        <div id="stats-bar">
            <div class="stat-item"><span class="stat-label">Score</span><span id="score-disp" class="stat-value">0</span></div>
            <div class="stat-item"><span class="stat-label">Lvl</span><span id="level-disp" class="stat-value">1</span></div>
            <div class="stat-item"><span class="stat-label">Time</span><span id="timer-disp" class="stat-value">10:00</span></div>
        </div>

        <div id="game-area">
            <div id="problem-text">Press Start to Begin!</div>
            <input type="text" id="answer-input" class="hidden" placeholder="Type answer here...">
            <button id="submit-btn" class="btn btn-primary hidden">Submit</button>
            <div id="feedback" style="margin-top: 10px; font-weight: 700;"></div>
        </div>

        <button id="start-btn" class="btn btn-primary">Start Game</button>

        <div id="controls">
            <button id="lvl-btn" class="btn btn-sec">Levels</button>
            <button id="hint-btn" class="btn btn-sec">Hint</button>
            <button id="mute-btn" class="btn btn-sec">Mute</button>
            <button id="full-btn" class="btn btn-sec">Full</button>
            <button id="reset-btn" class="btn btn-sec" style="background:var(--mathly-red)">Reset</button>
        </div>
    </div>

    <div id="levels-modal">
        <div class="modal-content">
            <h3 style="color: var(--mathly-yellow);">Select Level</h3><br>
            <div id="level-list"></div>
            <button onclick="document.getElementById('levels-modal').style.display='none'" class="btn btn-sec" style="margin-top:10px; width:100%;">Close</button>
        </div>
    </div>
</div>

<script>
    let state = { active: false, score: 0, level: 1, timer: 600, currentA: '', hint: '', muted: false, stars: JSON.parse(localStorage.getItem('ax_stars')) || {1:0, 2:0, 3:0} };
    let correctSynth, wrongSynth, afroBeat, isAudioInit = false;

    const themes = {
        1: "linear-gradient(135deg, #1a2a6c 0%, #2b3952 100%)",      
        2: "linear-gradient(135deg, #4b0082 0%, #1a1a2e 100%)",      
        3: "linear-gradient(135deg, #e67e22 0%, #d35400 100%)"       
    };

    async function initAudio() {
        if (isAudioInit) return;
        try {
            await Tone.start();
            correctSynth = new Tone.DuoSynth().toDestination();
            wrongSynth = new Tone.MetalSynth({ envelope: { release: 0.2 } }).toDestination();
            const kick = new Tone.MembraneSynth().toDestination();
            afroBeat = new Tone.Loop(t => { kick.triggerAttackRelease("C1", "8n", t); }, "4n");
            Tone.Transport.bpm.value = 118;
            isAudioInit = true;
        } catch (e) { console.log("Audio failed to load"); }
    }

    function normalize(s) { return s.toString().toLowerCase().replace(/[\s\-,]/g, ''); }

    function numToWords(n) {
        const a = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
        const b = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
        const h = (num) => {
            if (num < 20) return a[num];
            if (num < 100) return b[Math.floor(num/10)] + (num%10 !== 0 ? ' ' + a[num%10] : '');
            if (num < 1000) return a[Math.floor(num/100)] + ' hundred' + (num%100 !== 0 ? ' and ' + h(num%100) : '');
            return h(Math.floor(num/1000)) + ' thousand' + (num%1000 !== 0 ? (num%1000 < 100 ? ' and ' : ' ') + h(num%1000) : '');
        };
        return n === 0 ? "zero" : h(n);
    }

    function gen() {
        let n = state.level === 1 ? Math.floor(Math.random()*9000)+1000 : state.level === 2 ? Math.floor(Math.random()*40000)+10000 : Math.floor(Math.random()*50000)+50000;
        const words = numToWords(n);
        if (Math.random() > 0.5) {
            document.getElementById('problem-text').innerHTML = `Write <b>${n.toLocaleString()}</b> in words:`;
            state.currentA = normalize(words);
            state.hint = `Starts with "${words.split(' ')[0]}..."`;
        } else {
            document.getElementById('problem-text').innerHTML = `Write <b>"${words}"</b> in figures:`;
            state.currentA = normalize(n.toString());
            state.hint = `It is a ${n.toString().length}-digit number.`;
        }
        document.getElementById('answer-input').value = '';
    }

    function updateTheme(l) {
        document.getElementById('game-wrapper').style.background = themes[l];
        document.getElementById('game-title').innerText = l === 3 ? "AssignmentX Expert" : l === 2 ? "AssignmentX Intermediate" : "AssignmentX Numbers";
    }

    async function start(l = 1) {
        await initAudio();
        state.level = l; state.score = 0; state.timer = 600; state.active = true;
        updateTheme(l);
        document.getElementById('start-btn').classList.add('hidden');
        document.getElementById('answer-input').classList.remove('hidden');
        document.getElementById('submit-btn').classList.remove('hidden');
        document.getElementById('levels-modal').style.display = 'none';
        if (!state.muted && afroBeat) { Tone.Transport.start(); afroBeat.start(0); }
        gen(); updateStats();
        if (state.interval) clearInterval(state.interval);
        state.interval = setInterval(() => { state.timer--; updateStats(); if(state.timer<=0) end(); }, 1000);
    }

    function check() {
        const user = normalize(document.getElementById('answer-input').value);
        const f = document.getElementById('feedback');
        if (user === state.currentA) {
            state.score += 10; f.innerHTML = "‚úÖ CORRECT!"; f.className = "correct";
            if (!state.muted && correctSynth) correctSynth.triggerAttackRelease("C4", "8n");
            setTimeout(() => { f.innerText = ''; gen(); }, 1000);
        } else {
            f.innerHTML = "‚ùå TRY AGAIN"; f.className = "incorrect";
            if (!state.muted && wrongSynth) wrongSynth.triggerAttackRelease("G2", "4n");
        }
        updateStats();
    }

    function end() {
        state.active = false; clearInterval(state.interval); if(Tone) Tone.Transport.stop();
        document.getElementById('problem-text').innerHTML = `DONE!<br>Final Score: ${state.score}`;
        document.getElementById('start-btn').classList.remove('hidden');
        document.getElementById('answer-input').classList.add('hidden');
        document.getElementById('submit-btn').classList.add('hidden');
    }

    function updateStats() {
        document.getElementById('score-disp').innerText = state.score;
        document.getElementById('level-disp').innerText = state.level;
        const m = Math.floor(state.timer/60), s = state.timer%60;
        document.getElementById('timer-disp').innerText = `${m}:${s<10?'0':''}${s}`;
    }

    function toggleFullscreen() {
        const elem = document.getElementById('game-wrapper');
        if (!document.fullscreenElement) {
            if (elem.requestFullscreen) elem.requestFullscreen();
            else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
            else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
        } else {
            if (document.exitFullscreen) document.exitFullscreen();
        }
    }

    document.getElementById('start-btn').onclick = () => start(1);
    document.getElementById('submit-btn').onclick = check;
    document.getElementById('full-btn').onclick = toggleFullscreen;
    document.getElementById('lvl-btn').onclick = () => {
        const list = document.getElementById('level-list'); list.innerHTML = '';
        for (let i = 1; i <= 3; i++) {
            const card = document.createElement('div'); card.className = 'level-card';
            card.innerHTML = `<span>Level ${i}</span><span>‚≠ê</span>`;
            card.onclick = () => start(i); list.appendChild(card);
        }
        document.getElementById('levels-modal').style.display = 'flex';
    };
    document.getElementById('hint-btn').onclick = () => { document.getElementById('feedback').innerText = `üí° ${state.hint}`; state.score = Math.max(0, state.score - 2); updateStats(); };
    document.getElementById('reset-btn').onclick = () => { localStorage.clear(); location.reload(); };
    document.getElementById('mute-btn').onclick = () => { state.muted = !state.muted; document.getElementById('mute-btn').innerText = state.muted ? "Unmute" : "Mute"; if(state.muted) Tone.Transport.pause(); else if(state.active) Tone.Transport.start(); };
    document.getElementById('answer-input').onkeydown = (e) => { if (e.key === 'Enter') check(); };
</script>
</body>
</html>