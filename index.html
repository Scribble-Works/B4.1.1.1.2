<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AssignmentX Numbers Game Challenge</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/tone@14.7.58/build/Tone.js"></script>
    <style>
        :root {
            --mathly-grey-dark: #2c3e50;
            --mathly-grey-light: #ecf0f1;
            --mathly-blue: #3498db;
            --mathly-green: #2ecc71;
            --mathly-red: #e74c3c;
            --mathly-yellow: #f1c40f;
            --lvl-bg: linear-gradient(135deg, #1a2a6c 0%, #2b3952 100%);
        }

        #game-wrapper {
            position: relative;
            width: 100%;
            height: 100vh;
            background: var(--lvl-bg);
            transition: background 0.8s ease;
            color: var(--mathly-grey-light);
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* Initial Game Background Tapestry */
        .bg-symbols {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            font-size: 10vw; color: rgba(255, 255, 255, 0.03);
            pointer-events: none; z-index: 0; font-weight: 900;
            display: flex; flex-wrap: wrap; justify-content: center; align-items: center;
            overflow: hidden;
        }

        #game-container {
            width: 90%; max-width: 500px; padding: 25px;
            background: rgba(0, 0, 0, 0.35); border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1; text-align: center;
        }

        #stats-bar {
            display: flex; justify-content: space-between;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px; border-radius: 12px; margin-bottom: 20px;
        }
        .stat-item { display: flex; flex-direction: column; }
        .stat-label { font-size: 0.65em; text-transform: uppercase; opacity: 0.7; }
        .stat-value { font-size: 1.1em; font-weight: 900; color: var(--mathly-blue); }

        #game-area {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px; border-radius: 15px; margin-bottom: 20px;
            min-height: 180px; display: flex; flex-direction: column; justify-content: center;
        }
        #problem-text { font-size: 1.2em; font-weight: 700; margin-bottom: 15px; min-height: 60px; line-height: 1.4; }

        input {
            width: 100%; padding: 12px; font-size: 1.1em; border-radius: 8px; border: 2px solid var(--mathly-blue);
            background: rgba(0,0,0,0.4); color: white; text-align: center; margin-bottom: 10px; box-sizing: border-box;
        }

        .btn {
            width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: 900;
            cursor: pointer; text-transform: uppercase; transition: 0.2s;
        }
        .btn-primary { background: var(--mathly-green); color: var(--mathly-grey-dark); }
        
        #controls { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-top: 15px; }
        .btn-sec { background: var(--mathly-blue); color: white; font-size: 0.6em; padding: 8px 1px; }

        .correct { color: var(--mathly-green); }
        .incorrect { color: var(--mathly-red); }
        .hidden { display: none !important; }

        /* Overlays */
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center; z-index: 100;
            backdrop-filter: blur(5px);
        }
        .modal-content { background: var(--mathly-grey-dark); padding: 25px; border-radius: 15px; width: 85%; max-width: 400px; border: 2px solid var(--mathly-blue); }
    </style>
</head>
<body style="margin:0; padding:0;">

<div id="game-wrapper">
    <div class="bg-symbols">Œ£ ‚à´ ‚àû ‚â† ‚âà ¬± ‚àö œÄ Œ± Œ≤ Œ≥ Œî Œ∏ Œ©</div>
    
    <div id="rules-page" class="overlay">
        <div class="modal-content">
            <header>
            <h2 id="game-title" style="color: var(--mathly-yellow); margin-bottom: 10px;">AssignmentX Numbers Game Challenge</h2>
            <p>B4.1.1.1.1: Read and Write Numbers up to 100,000</p>
            </header>
            <h2 id="rules-title" style="color: var(--mathly-yellow); margin-top: 0; text-align: center;">üìú Game Rules</h2>
            <div id="end-message" style="margin-bottom: 15px; text-align: center; display: none;"></div>
            <ul id="rules-info" style="line-height: 1.6; margin: 20px 0; padding-left: 20px;">
                <li><b>Goal:</b> Convert numbers to words and back.</li>
                <li><b>Points:</b> Get <b>+10 points</b> per correct answer.</li>
                <li><b>Hints:</b> Cost <b>-2 points</b> each.</li>
                <li><b>Time:</b> 10 minutes to reach the top!</li>
            </ul>
            <button id="start-btn" class="btn btn-primary">Start Game!</button>
        </div>
    </div>
    
    <div id="game-container">
        <header>
            <h2 id="game-title" style="color: var(--mathly-yellow); margin-bottom: 10px;">AssignmentX Numbers Game</h2>
            <p>B4.1.1.1.1: Read and Write Numbers up to 100,000</p>
        </header>

        <div id="stats-bar">
            <div class="stat-item"><span class="stat-label">Score</span><span id="score-disp" class="stat-value">0</span></div>
            <div class="stat-item"><span class="stat-label">Lvl</span><span id="level-disp" class="stat-value">1</span></div>
            <div class="stat-item"><span class="stat-label">Time</span><span id="timer-disp" class="stat-value">10:00</span></div>
        </div>

        <div id="game-area">
            <div id="game-content-box" style="visibility: hidden;">
                <div id="problem-text">Press Start to Begin!</div>
                <input type="text" id="answer-input" class="hidden" placeholder="Type answer here..." autocomplete="off">
                <button id="submit-btn" class="btn btn-primary hidden">Submit</button>
            </div>
            <div id="feedback" style="margin-top: 10px; font-weight: 700;"></div>
        </div>

        <div id="controls">
            <button id="lvl-btn" class="btn btn-sec">Levels</button>
            <button id="hint-btn" class="btn btn-sec">Hint</button>
            <button id="mute-btn" class="btn btn-sec">Mute</button>
            <button id="pause-btn" class="btn btn-sec">Pause</button>
            <button id="reset-btn" class="btn btn-sec" style="background:var(--mathly-red)">Reset</button>
        </div>
    </div>

    <div id="levels-modal" class="overlay" style="display:none;">
        <div class="modal-content">
            <h3 style="color: var(--mathly-yellow);">Select Difficulty</h3><br>
            <div id="level-list"></div>
            <button onclick="document.getElementById('levels-modal').style.display='none'" class="btn btn-sec" style="margin-top:10px; width:100%;">Close</button>
        </div>
    </div>
</div>

<script>
    let state = { 
        active: false, paused: false, score: 0, level: 1, timer: 600, currentA: '', hint: '', muted: false,
        highScores: JSON.parse(localStorage.getItem('ax_high_scores')) || {1:0, 2:0, 3:0}
    };
    let correctSynth, wrongSynth, afroBeat, isAudioInit = false;

    const themes = {
        1: "linear-gradient(135deg, #1a2a6c 0%, #2b3952 100%)",      
        2: "linear-gradient(135deg, #4b0082 0%, #1a1a2e 100%)",      
        3: "linear-gradient(135deg, #e67e22 0%, #d35400 100%)"       
    };

    async function initAudio() {
        if (isAudioInit) return;
        try {
            await Tone.start();
            correctSynth = new Tone.DuoSynth().toDestination();
            wrongSynth = new Tone.MetalSynth({ envelope: { release: 0.2 } }).toDestination();
            afroBeat = new Tone.Loop(t => { (new Tone.MembraneSynth().toDestination()).triggerAttackRelease("C1", "8n", t); }, "4n");
            isAudioInit = true;
        } catch (e) {}
    }

    function normalize(s) { return s.toString().toLowerCase().replace(/[\s\-,]/g, ''); }

    function numToWords(n) {
        const a = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine', 'ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
        const b = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
        const h = (num) => {
            if (num < 20) return a[num];
            if (num < 100) return b[Math.floor(num/10)] + (num%10 !== 0 ? ' ' + a[num%10] : '');
            if (num < 1000) return a[Math.floor(num/100)] + ' hundred' + (num%100 !== 0 ? ' and ' + h(num%100) : '');
            return h(Math.floor(num/1000)) + ' thousand' + (num%1000 !== 0 ? (num%1000 < 100 ? ' and ' : ' ') + h(num%1000) : '');
        };
        return n === 0 ? "zero" : h(n);
    }

    function gen() {
        let n = state.level === 1 ? Math.floor(Math.random()*9000)+1000 : state.level === 2 ? Math.floor(Math.random()*40000)+10000 : Math.floor(Math.random()*50000)+50000;
        const words = numToWords(n);
        if (Math.random() > 0.5) {
            document.getElementById('problem-text').innerHTML = `Write <b>${n.toLocaleString()}</b> in words:`;
            state.currentA = normalize(words);
            state.hint = `Starts with "${words.split(' ')[0]}..."`;
        } else {
            document.getElementById('problem-text').innerHTML = `Write <b>"${words}"</b> in figures:`;
            state.currentA = normalize(n.toString());
            state.hint = `It is a ${n.toString().length}-digit number.`;
        }
        document.getElementById('answer-input').value = '';
    }

    async function start(l = 1) {
        await initAudio();
        state.level = l; state.score = 0; state.timer = 600; state.active = true; state.paused = false;
        document.getElementById('game-wrapper').style.background = themes[l];
        document.getElementById('rules-page').style.display = 'none';
        document.getElementById('levels-modal').style.display = 'none';
        document.getElementById('answer-input').classList.remove('hidden');
        document.getElementById('submit-btn').classList.remove('hidden');
        document.getElementById('game-content-box').style.visibility = "visible";
        document.getElementById('feedback').innerText = '';
        if (!state.muted && afroBeat) { Tone.Transport.start(); afroBeat.start(0); }
        gen(); updateStats();
        if (state.interval) clearInterval(state.interval);
        state.interval = setInterval(() => { if(!state.paused) { state.timer--; updateStats(); if(state.timer<=0) end(); } }, 1000);
    }

    function togglePause() {
        if (!state.active) return;
        state.paused = !state.paused;
        document.getElementById('pause-btn').innerText = state.paused ? "Resume" : "Pause";
        document.getElementById('game-content-box').style.visibility = state.paused ? "hidden" : "visible";
        if (state.paused) Tone.Transport.pause(); else if(!state.muted) Tone.Transport.start();
    }

    function check() {
        if(state.paused) return;
        const user = normalize(document.getElementById('answer-input').value);
        const f = document.getElementById('feedback');
        if (user === state.currentA) {
            state.score += 10; f.innerHTML = "‚úÖ CORRECT!"; f.className = "correct";
            if (!state.muted && correctSynth) correctSynth.triggerAttackRelease("C4", "8n");
            setTimeout(() => { f.innerText = ''; gen(); }, 1000);
        } else {
            f.innerHTML = "‚ùå TRY AGAIN"; f.className = "incorrect";
            if (!state.muted && wrongSynth) wrongSynth.triggerAttackRelease("G2", "4n");
        }
        updateStats();
    }

    function end() {
        state.active = false; clearInterval(state.interval); Tone.Transport.stop();
        const isNewRecord = state.score > state.highScores[state.level];
        if(isNewRecord) {
            state.highScores[state.level] = state.score;
            localStorage.setItem('ax_high_scores', JSON.stringify(state.highScores));
        }
        document.getElementById('rules-title').innerText = "üèÅ Finished!";
        const endMsg = document.getElementById('end-message');
        endMsg.style.display = 'block';
        endMsg.innerHTML = `Score: <b>${state.score}</b><br>${isNewRecord ? 'üèÜ NEW RECORD!' : 'Best: ' + state.highScores[state.level]}`;
        document.getElementById('rules-info').style.display = 'none';
        document.getElementById('rules-page').style.display = 'flex';
        document.getElementById('start-btn').innerText = "Play Again";
    }

    function updateStats() {
        document.getElementById('score-disp').innerText = state.score;
        document.getElementById('level-disp').innerText = state.level;
        const m = Math.floor(state.timer/60), s = state.timer%60;
        document.getElementById('timer-disp').innerText = `${m}:${s<10?'0':''}${s}`;
    }

    document.getElementById('start-btn').onclick = () => {
        document.getElementById('rules-info').style.display = 'block';
        document.getElementById('end-message').style.display = 'none';
        start(1);
    };
    document.getElementById('submit-btn').onclick = check;
    document.getElementById('pause-btn').onclick = togglePause;
    document.getElementById('lvl-btn').onclick = () => {
        const list = document.getElementById('level-list'); list.innerHTML = '';
        for (let i = 1; i <= 3; i++) {
            const card = document.createElement('div');
            card.style.cssText = "background:rgba(255,255,255,0.05); padding:12px; border-radius:10px; margin-bottom:8px; cursor:pointer; border:1px solid var(--mathly-blue);";
            card.innerHTML = `<b>Level ${i}</b> <span style="float:right">Best: ${state.highScores[i]}</span>`;
            card.onclick = () => start(i); list.appendChild(card);
        }
        document.getElementById('levels-modal').style.display = 'flex';
    };
    document.getElementById('hint-btn').onclick = () => { 
        if(state.paused) return;
        document.getElementById('feedback').innerText = `üí° ${state.hint}`; 
        state.score = Math.max(0, state.score - 2); updateStats(); 
    };
    document.getElementById('reset-btn').onclick = () => { if(confirm("Reset everything?")) { localStorage.clear(); location.reload(); } };
    document.getElementById('mute-btn').onclick = () => { 
        state.muted = !state.muted; 
        document.getElementById('mute-btn').innerText = state.muted ? "Unmute" : "Mute"; 
        if(state.muted) Tone.Transport.pause(); else if(state.active && !state.paused) Tone.Transport.start(); 
    };
    document.getElementById('answer-input').onkeydown = (e) => { if (e.key === 'Enter') check(); };
</script>
</body>
</html>